TODO: three phases:

1. Component update + stack op queue
2. Stack queue execute
3. Invoke callbacks and if redraw requested, loop back to 1
