<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Mosaic</title>
		<style>
#root {margin:auto;max-width:600px;width:100%;}
.slice {animation:enter 1s;animation-fill-mode:forwards;background-image:url(flowers.jpg);height:60px;float:left;opacity:0;width:60px;}
.slice:nth-child(10n) {clear:right;}
.exit {animation:exit 1s;}

@keyframes enter {
	from {opacity:0;transform:rotate(-90deg) scale(0);}
	to {opacity:1;transform:rotate(0) scale(1);}
}
@keyframes exit {
	from {opacity:1;transform:rotate(0) scale(1);}
	to {opacity:0;transform:rotate(90deg) scale(0);}
}
		</style>
	</head>
	<body>
		<div id="root"></div>
		<script src="../../mithril.js"></script>
		<script>
const {m} = Mithril

const range = (start, end) =>
	Array.from({length: end - start}, (_, i) => i + start)

const backgroundPosition = (i, step) =>
	// X% Y%
	`${i % step * (step + 1)}% ${Math.floor(i / step) * (step + 1)}%`

function View(attrs, context, [state, schedule] = [0, true]) {
	if (schedule) setTimeout(() => context.update([state + 1, true]), 100)
	const show = (state & 2) === 0
	const remove = state === 3

	return {
		next: [state, false],
		view: m(".container",
			remove() ? null : range(100).map((i) => m(".slice", {
				class: show() ? null : "exit",
				style: {backgroundPosition: backgroundPosition(i, 10)},
			}))
		)
	}
}
Mithril.render(document.getElementById("root"), m(View))
		</script>
	</body>
</html>
